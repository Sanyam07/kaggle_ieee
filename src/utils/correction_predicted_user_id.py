import numpy as np
import pandas as pd


def correction_predicted_user_id_v1():
    df = pd.read_csv('../../data/interim/20190901_user_ids_share.csv')
    miss_identified_users = [455,456,689,691,693,990,994,997,1028,1328,2211,2483,2572,2700,4861,5643,5676,5776,7499,8606,8981,10192,10709,10720,10759,10792,10808,10832,10855,10863,10881,10896,10971,10975,11003,11012,11028,11046,11047,11052,11688,12882,12903,12910,12944,12945,12986,13002,13021,13025,13041,13060,13073,13084,13094,13095,13103,13115,13143,13159,13193,13208,13212,13281,13287,14761,17376,17786,17794,17916,18052,18074,18639,18701,18718,18754,18787,19616,20916,20920,20922,20925,20927,20938,20953,20958,20965,20987,21006,21012,21042,21046,22791,24716,25472,26328,26356,27286,28072,28141,28146,28147,28170,28203,28207,28213,28232,28257,28263,28264,28284,28292,28297,28315,28316,28317,28319,28326,28332,28344,28353,28378,28399,28400,28437,28438,28458,28466,28479,28480,28481,28490,28520,28539,28591,28596,28616,28638,28658,28670,28767,28817,28821,28876,28897,28908,28947,28964,28984,28998,29005,29007,29017,29035,29036,30215,30631,30670,33186,33306,33336,33733,34009,34054,34100,34476,34491,34495,35792,35831,35851,35890,36043,37625,39368,40616,40767,41373,41379,41394,41409,41414,41420,41431,41457,41458,41524,41525,41535,41546,41586,41593,41598,41600,41604,41610,41621,41623,41628,41634,41641,41648,41666,41676,41718,41726,41745,41788,41796,41810,41815,41817,41820,41869,41887,41891,41910,41911,41936,41970,41985,41988,41998,42003,42006,42008,42009,42027,42028,42037,42048,42051,42052,43107,43116,43117,43138,43143,43147,43159,43173,43186,43188,43218,43228,43231,43286,43287,43304,43316,43320,43330,43356,43361,43368,43371,43388,43402,43412,43441,43444,43453,44255,45474,45785,46049,47731,50686,50697,50705,50723,50740,50752,50804,50812,50840,50846,51401,51980,51982,52005,52018,52028,52314,54012,54079,54109,54144,54146,54159,54182,54200,54223,54243,54252,54260,54275,54282,54291,54303,54307,54315,54327,54355,54369,54397,54398,54402,54422,54434,54438,54440,54468,54486,54502,54504,54507,54526,54529,54533,54556,54569,54573,54599,54614,54630,54631,54635,54641,54658,54665,54725,54729,54737,54759,54764,54797,54806,54828,54829,54833,54838,54840,54844,54862,54864,56393,57328,57384,57874,57930,58020,58025,58297,58337,58370,58447,58451,58553,58684,59102,62085,62332,62753,62819,63235,63263,65182,65252,66018,66553,66649,66668,67985,68465,70023,70587,71841,72232,72581,74487,75406,75591,75600,77211,77326,77400,77437,77520,77595,77812,77872,78099,79112,79650,79910,80201,80287,80392,80406,81743,81767,82681,82836,84235,84544,85696,85819,88472,88493,88616,89136,89527,89612,89806,90244,91189,93966,94007,94874,96153,97313,97325,97463,97650,98249,100127,100810,100848,100858,100869,100875,100878,100894,100906,100941,100971,100986,100992,101010,101025,101042,101062,101064,101091,101104,101117,101127,101131,101133,101178,101180,101186,101201,101869,103207,103232,103235,103245,103293,103307,103312,103320,103329,103345,103349,103359,103366,103369,103378,103382,103407,103411,103417,103459,103469,103470,103475,103488,103490,103491,103509,103521,103522,103531,103539,103542,103554,103564,103567,103586,103587,103601,103602,103607,103611,103629,103631,103660,103663,103676,103682,103684,103697,103701,103711,103726,103738,103740,103757,103758,103776,103819,103828,103829,103832,103847,103848,103854,104521,104522,104536,105068,106213,106325,106931,106949,106963,106967,107041,107101,107144,107187,107205,107216,107242,107263,107269,108168,108598,110414,111113,111577,111579,112000,112164,112198,112241,112423,112531,112687,112853,112966,113078,113196,113215,113296,113463,113476,113576,113787,113866,113972,113976,113997,114045,114402,114423,114451,114487,114488,117739,117756,117766,117817,117828,117877,117924,117929,117937,117940,117953,117968,117969,117974,117976,117977,117986,117995,118009,118010,118034,118044,118045,118050,118052,118053,118055,118063,118085,118095,118102,118103,118116,118117,118118,118120,118121,118131,118134,118154,118177,118188,118210,118222,118246,118261,118269,118272,118284,118303,118306,118324,118336,118345,118356,118362,118369,118370,118376,118386,118398,118401,118402,118408,118415,118423,118424,118453,118456,118458,118461,118468,118475,118478,118491,118493,118495,118496,118509,118520,118532,118537,118541,118560,118561,118564,118567,118571,118578,118590,118599,118604,118624,118635,118648,118654,118656,118658,118662,118664,118666,118667,118668,118675,118679,118686,118690,118691,118702,118710,118715,118716,118717,118725,118729,118731,118732,118740,118746,118749,118751,118759,118761,118763,118770,119836,120757,121825,121834,121890,121894,121895,121946,121968,121977,121981,121984,121985,121986,121990,121992,121993,121994,121997,121998,122001,122011,122027,122033,122050,122079,122080,123788,124684,126222,126250,126255,126302,126313,126337,126350,128156,128965,129435,130049,130256,130394,130432,130580,131437,131457,131478,131481,131493,131510,131541,131554,131587,131596,131610,131611,131615,131620,131635,131649,131675,131687,131699,131709,131720,131739,132749,132869,132877,133202,133377,135872,136699,136702,136707,136764,136802,136822,136842,136853,136868,136871,136885,136895,136900,136924,136934,138842,138880,140654,140678,140679,140692,140724,140745,140762,140765,140795,140858,140886,140912,140913,140918,140926,140929,140961,140963,140972,140976,140993,141000,141052,141062,142706,142823,143291,145205,149934,149969,151977,152238,152647,152814,152817,152822,153072,154007,154629,154708,154709,155227,155424,155461,155503,155655,155714,155729,155977,156082,157768,159300,159727,159730,159731,159732,159734,159736,159739,159743,159744,159745,159746,159767,161357,161556,161563,161937,161977,162571,164029,164052,164059,164262,165080,165081,165494,165540,165541,165674,165761,165806,166127,167964,168045,168087,168166,169173,169465,170011,171015,172732,173049,173061,173071,173074,173118,173125,173152,176063,176087,176120,176138,176153,176158,176168,176174,176179,176233,176249,176264,176289,176293,176306,176313,176328,176333,176359,176366,176368,176384,176406,176414,176442,176455,176460,176467,176488,176501,176520,176585,176588,177744,180701,180715,180727,180733,180742,180763,180773,180779,180821,180831,180833,180853,180883,180912,180934,180947,180956,181038,182194,182836,183809,185395,187500,187555,188630,188851,189186,189810,190224,190312,190397,190858,193253,193340,194303,194343,194356,194366,194368,194369,194392,194820,195400,196057,196291,196323,197391,197466,197467,197468,197491,197507,197537,197626,197627,197798,197985,199855,201874,201894,202015,202159,202160,202197,202286,202304,202363,202375,202376,202377,202397,202398,202408,202414,202415,202420,202428,202469,202477,202478,202481,202483,202491,202492,202493,202510,202513,202517,202520,202529,202530,202532,202538,202556,202564,202565,202588,202596,202598,202603,202615,202616,202648,202671,202687,202688,202694,202700,202710,202711,202713,202718,202722,202725,202736,202737,202743,202750,202778,202786,202808,202818,202862,202888,202893,202917,202931,202933,202941,202942,202950,202963,202995,202996,203007,203008,203046,203055,203059,203060,203074,203090,203099,203103,203130,203136,203143,203170,203180,203183,203205,203220,203237,203255,203270]
    max_user_id = df['predicted_user_id'].max()
    
    # fix miss_identified_users
    df['predicted_user_id'] = np.where(
        df['predicted_user_id'].isin(miss_identified_users),
        np.nan, df['predicted_user_id'])

    """
    # fill nan with random values
    df['predicted_user_id'] = np.where(
        df['predicted_user_id'].isnull(),
        max_user_id * 10 + df.index,
        df['predicted_user_id'])
    """

    # save
    df.to_csv('../../data/interim/20190901_user_ids_share_v1.csv', header=True, index=False)


if __name__ == '__main__':
    correction_predicted_user_id_v1()
